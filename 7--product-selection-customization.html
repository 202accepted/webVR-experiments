<!doctype html>
<html>
<head>
   <title>7 - Product Selection &amp; Customization</title>
   <meta name="viewport" content="width=device-width,initial-scale=1,shrink-to-fit=no,user-scalable=no,maximum-scale=1">
   <script src="bower_components/aframe/dist/aframe-v0.2.0.min.js"></script>
   <script src="bower_components/Keypress/keypress.js"></script>
   <script src="bower_components/is_js/is.min.js"></script>
   <style>
   *{
      cursor: none;
   }
   </style>

</head>
<body>

   <a-scene id="main-scene" fog="type: exponential; color: #d81159; density: .02">

      <!--
         Credits
         Environment:
         Original layout design:
         Cart:
      -->
      <!--
         Dark Blue:  006ba6
         Blue:       0496ff
         Yellow:     ffbc42
         Pink:       d81159
         Plum:       8f2d56
      -->

      <a-assets>
         <!-- <a-asset-item id="model-environment" src="assets/7/models/scene-forest-mountain.dae"></a-collada-model> -->
      </a-assets>

      <!-- Global Settings -->
      <a-sky color="#d81159"></a-sky>
      <a-light type="ambient" color="#ccc" intensity=".1"></a-light>
      <a-light type="directional" color="#fff" position="1 1 .5" intensity="1"></a-light>
      <a-light type="directional" color="#ffbc42" position="-1 1 .4" intensity=".5"></a-light>
      <a-plane height="20" width="20" material="color: #932843" rotation="-90 0 0" position="0 0 0"></a-plane>

      <!-- Human Camera -->
      <a-camera id="human-camera" position="0 1.7 0" wasd-controls-enabled="true" look-controls-enabled="true"  mouse-controls active="true" near=".05">
         <a-entity position="0 0 -.5" geometry="primitive: plane; height: .005; width: .005"  material="color: #fff"></a-entity>
      </a-camera>

      <a-entity id="world">

         <a-entity id="environment" position="0 0 0" rotation="0 0 0">
            <a-collada-model src="#model-environment"></a-collada-model>
         </a-entity>

         <!-- <a-entity id="wireframe-flat" class="target" position="0 .15 -.1" domflag>
            <a-image src="assets/7/henley-mockup-3" height="3" width="2"></a-image>
         </a-entity> -->

         <a-entity id="wireframe-flat" class="target" position="0 .15 -.1">

            <a-image class="js-set" src="assets/7/henley-mockup-3-z3@2x.png" height="3" width="2" data-height="600" data-width="540" position="0 1.5 -.2"></a-image>

            <a-image class="js-set" src="assets/7/henley-mockup-3-z2@2x.png" height="3" width="2" data-height="600" data-width="540" position="0 1.5 0"></a-image>

            <a-image class="js-set" src="assets/7/henley-mockup-3-z1@2x.png" height="3" width="2" data-height="600" data-width="540" position="0 1.5 .05"></a-image>

         </a-entity>

         <a-entity   id="wireframe-curved"
                     class="target"
                     position="0 1.65 0"
                     data-heightorig="600"
                     data-widthorig="540"
                     data-radius=".8"
                     data-delta=".1 0 -.1"
                     theta-length="120"
                     data-scale="1"
                     domFlag>

            <a-curvedimage class="js-set" src="assets/7/henley-mockup-3-z3@2x.png"></a-curvedimage>
            <a-curvedimage class="js-set" src="assets/7/henley-mockup-3-z2@2x.png"></a-curvedimage>
            <a-curvedimage class="js-set" src="assets/7/henley-mockup-3-z1@2x.png"></a-curvedimage>

         </a-entity>

         <a-entity id="wireframe-threeDim" class="target" position="0 .15 2.5" >
            <a-box height=".5" width=".5" depth=".5"></a-box>
         </a-entity>

      </a-entity>

   </a-scene>

   <script>

      var settings = {
         target: 'wireframe-curved',
         hiddenPosition: {
            x: 0,
            y: -1000,
            z: 0
         },
         reload: false,    // When developing, it's nice if your phone reloads automatically
         reloadTime: 10    // In seconds

      }

      var scene = document.querySelector('#main-scene');
      var world = scene.querySelector('#world');

      scene.addEventListener('loaded', function(){

         setImagesCurved(true);

         toggleTargetTo(settings.target);

         if(settings.reload == true){
            scene.enterVR();
            reloadPage(settings.reloadTime);
         }

      });

      function reloadPage(seconds){

         function reloadCallback(){
            return function(){
               window.location.reload();
            }
         }
         var millis = seconds * 1000;

         setTimeout(reloadCallback(), millis);

      }

      // KeyListener
      var keyListener = new window.keypress.Listener();
      keyListener.simple_combo('c', function(){

         //console.log(targetsHTML.wireframe);

      });
      keyListener.simple_combo('1', function(){

         toggleTargetTo('wireframe-flat');

      });
      keyListener.simple_combo('2', function(){

         toggleTargetTo('wireframe-curved');

      });
      keyListener.simple_combo('3', function(){

         toggleTargetTo('wireframe-threeDim');

      });


      var targets = {
         wireframeFlat:       {
            el: scene.querySelector('#wireframe-flat'),
            initPosition: scene.querySelector('#wireframe-flat').getAttribute('position')
         },
         wireframeCurved:     {
            el: scene.querySelector('#wireframe-curved'),
            initPosition: scene.querySelector('#wireframe-curved').getAttribute('position')
         },
         wireframeThreeDim:   {
            el: scene.querySelector('#wireframe-threeDim'),
            initPosition: scene.querySelector('#wireframe-threeDim').getAttribute('position')
         },
         active: settings.target
      }


      // Set the parameters of curved image sets using parent settings
      //
      //
      function setImagesCurved(setBool){

         var curvedSetParent = targets.wireframeCurved.el;
         var curvedSet = curvedSetParent.querySelectorAll('a-curvedimage');

         var parameters = {
            heightorig:       curvedSetParent.getAttribute('data-heightorig'),
            widthorig:        curvedSetParent.getAttribute('data-widthorig'),
            radius:           curvedSetParent.getAttribute('data-radius'),
            delta:            curvedSetParent.getAttribute('data-delta').split(' '),
            thetaLength:      curvedSetParent.getAttribute('theta-length'),
            thetaStart:       curvedSetParent.getAttribute('theta-start'),
            scale:            curvedSetParent.getAttribute('data-scale')
         }

         // thetaLength is governing wrapper

         // Apply parent values

         var zeroithPosition = parameters.delta.indexOf('0');

         for(var i = 0; i < curvedSet.length; i++){

            var el = curvedSet[i];

            el.setAttribute('radius', parameters.radius);

            parameters.heightToWidth = parameters.heightorig / parameters.widthorig;
            parameters.height = parameters.heightToWidth * parameters.radius * (2 * Math.PI * (parameters.thetaLength / 360));
            el.setAttribute('height', parameters.height);


            el.setAttribute('theta-length', parameters.thetaLength);

            if(parameters.thetaStart == undefined){
               el.setAttribute('theta-start', (360 - parameters.thetaLength) / 2);

            }else{
               el.setAttribute('theta-start', parameters.thetaStart);
            }

            // set deltas
            // find zero delta

            if(el.getAttribute('scale') == null){
               el.setAttribute('scale', parameters.scale);
            }
            var scale = {};

            // for(var k = 0; k < 3; k++){
            //    scale[k] = Number(parameters.delta[i])
            // }
            scale = {
               x: Number(parameters.scale) + Number(parameters.delta[i]),
               y: Number(parameters.scale) + Number(parameters.delta[i]),
               z: Number(parameters.scale) + Number(parameters.delta[i])
            }
            console.log(scale);
            // console.log(el.getAttribute('scale'));
            el.setAttribute('scale', scale);


            // BROKE, TRY COMPUTED GEOMETRY
            // el.setAttribute('scale', scale)
            // console.log(el);
            // var elGeometry = el.getAttribute('scale');
            // elGeometry.scale = scale;
            // el.setAttribute('geometry', elGeometry);
            // console.log(elGeometry);
            // console.log(givenGeometry);
            // givenGemetry.setAttribute('scale', scale);
            // givenGemetry.scale


         }






         // find zero delta
         // calculate radius
            //





         // curvedSet.getAttribute('delta', parameters.delta);
         // for(var i = 0; i < parameters.delta.length; i++){

         // }


         // Curved images
         // var curvedImages = scene.find('a-curvedimage.js-set');
         // var curvedwidthorig = curvedImages.data('width');
         // var thetaLength = curvedImages.getAttribute('theta-length');

         // var thetaPercentage = thetaLength / 360;

         // var radius = (curvedwidthorig / (2 * Math.PI * thetaPercentage)) / 200; // magic number right now
         // console.log('Suggested Radius: ' + radius);

         // if(setBool == true)
         //    curvedImages.getAttribute('radius', radius);
      }

      function setImagesFlat(setBool){

         // Flat images
         var flatImages = scene.find('a-image.js-set');
         var flatWidthOriginal = flatImages.getAttribute('data-width');
         var flatWidthHeight = flatImages.getAttribute('data-height'); // what?
         var flatHeightOriginal = flatImages.getAttribute('data-height');

         var width = flatWidthHeight * flatWidthOriginal / flatHeightOriginal;

         console.log('Suggested Width: ' + width);

         if(setBool == true)
            flatImages.getAttribute('width', width);
      }

      function targetsKey(targetKey){
         if(targetKey == 'wireframeFlat' || targetKey == 'wireframe-flat'){
            return 0;
         }
         else if(targetKey == 'wireframeCurved' || targetKey == 'wireframe-curved'){
            return 1;
         }
         else if(targetKey == 'wireframeThreeDim' || targetKey == 'wireframe-threeDim'){
            return 2;
         }
         else{
            console.log('Error in targetsKey()');
         }
      }

      function toggleTargetTo(toggleTo){
         var els = scene.querySelectorAll('.target');
         forEach(els, function(el){

            el.setAttribute('position', settings.hiddenPosition.x + ' ' + settings.hiddenPosition.y + ' ' + settings.hiddenPosition.z);
         });

         switch (toggleTo){
            case 'wireframe-flat':
               var pos = targets.wireframeFlat.initPosition;
               break;

            case 'wireframe-curved':
               var pos = targets.wireframeCurved.initPosition;
               break;

            case 'wireframe-threeDim':
               var pos = targets.wireframeThreeDim.initPosition;
               break;

            default:
               console.log('Wrong variable passed on toggleTargetTo()');
               return;
               break;
         }

         scene.querySelector('#' + toggleTo).setAttribute('position', pos.x + ' ' + pos.y + ' ' + pos.z);

         targets.active = toggleTo;

      }

      function forEach(array, action) {
         for (var i = 0; i < array.length; i++)
         action(array[i]);
      }

   </script>
   </body>
</html>
