<!doctype html>
<html>
<head>
   <title>9 - Space</title>
   <meta name="viewport" content="width=device-width,initial-scale=1,shrink-to-fit=no,user-scalable=no,maximum-scale=1">
   <script src="bower_components/aframe/dist/aframe-v0.2.0.js"></script>
   <script src="bower_components/aframe-layout-component/dist/aframe-layout-component.min.js"></script>
   <script src="bower_components/aframe-text-component/dist/aframe-text-component.min.js"></script>
   <script src="bower_components/Keypress/keypress.js"></script>
   <script src="js/global-functions.js"></script>
   <style>
   *{
      /*cursor: none;*/
   }
   </style>

</head>
<body>

   <a-scene id="main-scene" fog="type: exponential; color: #d81159; density: .00002">

      <!--
         Credits

      -->
      <!--
         Color Palette
      -->

      <a-assets>

         <a-mixin id="btn" geometry="primitive: cylinder; height:.05; radius: .18" material="color: black; opacity: .5" rotation="90 0 0"></a-mixin>


         <a-mixin id="font" text="size: .074; height: .02" material="color: #ddd"></a-mixin>
         <a-mixin id="font-sm" text="size: .06; height: .01" material="color:#bbb"></a-mixin>
         <a-mixin id="font-lg" text="size: .11; height: .03"></a-mixin>
         <video id="video" src="assets/8/city.mp4" autoplay loop></video>
      </a-assets>

      <!-- Global Settings -->
      <a-sky color="#111 "></a-sky>

      <!-- Human Camera -->
      <a-camera id="human-camera" position="0 1.7 0" active="true" near=".05">
         <a-entity position="0 0 -.5" geometry="primitive: plane; height: .005; width: .005" material="color: #fff"></a-entity>
      </a-camera>


      <!-- World Elements -->
      <a-entity id="universe" rotation="30 0 0" position="0 0 -200">
      <!-- <a-entity id="universe"> -->

         <a-plane height="50" width="50" material="color: #8f2d56; opacity: .4" rotation="-90 0 0" position="0 0 0"></a-plane>

         <a-sphere   id="sun"
                     class="star"
                     radius="5"
                     color="yellow">
         </a-sphere>

         <a-entity   id="mercury"
                     class="planet"
                     planetary-radius=".3"
                     planetary-color="gray"
                     planetary-axis="0 0 0"
                     planetary-position="180"
                     orbital-radius="10"
                     orbital-speed="10" domFlag>
                     <a-sphere></a-sphere>
                     <a-animation></a-animation>
         </a-entity>

         <a-entity   id="venus"
                     class="planet"
                     planetary-radius=".7"
                     planetary-color="purple"
                     planetary-axis="0 0 0"
                     planetary-position="0"
                     orbital-radius="25"
                     orbital-speed="10" domFlag>
                     <a-sphere></a-sphere>
                     <a-animation></a-animation>
         </a-entity>

         <a-entity   id="earth"
                     class="planet"
                     planetary-radius="1"
                     planetary-color="green"
                     planetary-axis="0 0 0"
                     planetary-position="90"
                     orbital-radius="50"
                     orbital-speed="10" domFlag>
                     <a-sphere></a-sphere>
                     <a-animation></a-animation>
         </a-entity>

         <a-entity   id="mars"
                     class="planet"
                     planetary-radius="1.1"
                     planetary-color="crimson"
                     planetary-axis="0 0 0"
                     planetary-position="0"
                     orbital-radius="70"
                     orbital-speed="5" domFlag>
                     <a-sphere></a-sphere>
                     <a-animation></a-animation>
         </a-entity>

         <a-entity   id="jupiter"
                     class="planet"
                     planetary-radius="7"
                     planetary-color="orange"
                     planetary-axis="0 0 0"
                     planetary-position="0"
                     orbital-radius="100"
                     orbital-speed="20" domFlag>
                     <a-sphere></a-sphere>
                     <a-animation></a-animation>
         </a-entity>

         <a-entity   id="saturn"
                     class="planet"
                     planetary-radius="5"
                     planetary-color="darkorange"
                     planetary-axis="0 0 0"
                     planetary-position="0"
                     orbital-radius="120"
                     orbital-speed="22" domFlag>
                     <a-sphere></a-sphere>
                     <a-animation></a-animation>
         </a-entity>

         <a-entity   id="neptune"
                     class="planet"
                     planetary-radius="1"
                     planetary-color="blue"
                     planetary-axis="0 0 0"
                     planetary-position="0"
                     orbital-radius="160"
                     orbital-speed="8" domFlag>
                     <a-sphere></a-sphere>
                     <a-animation></a-animation>
         </a-entity>

         <a-entity   id="uranus"
                     class="planet"
                     planetary-radius="1"
                     planetary-color="darkblue"
                     planetary-axis="0 0 0"
                     planetary-position="0"
                     orbital-radius="168"
                     orbital-speed="5" domFlag>
                     <a-sphere></a-sphere>
                     <a-animation></a-animation>
         </a-entity>

      </a-entity>

   </a-scene>

   <script>

      var settings = {
         camera: 1,
         enterVR: true,
         reload: false,                 // When developing, it's nice if your phone reloads automatically
         reloadTime: 6                  // In seconds
      }



      /*
         Setup global variables
      */
      var scene = document.querySelector('#main-scene');
      var universe = document.querySelector('#universe');

      var planets = {
         els: scene.querySelectorAll('.planet'),
         active: settings.camera
         // The rest of the object gets built with buildTargets()
      }

      /*
         Add event listener to run after scene is loaded
      */
      scene.addEventListener('loaded', function(){

         buildPlanets(planets);

         // toggleCameraTo(targets.active); // TODO: change to cameras

         devTools();

      });

      /*
         Keylistener functions
      */
      // Setup
      var keyListener = new window.keypress.Listener();

      // check targets object
      keyListener.simple_combo('c', function(){
         console.log(targets);
      });
      // KeyListenerSimpleCombo('target', [1, 2, 3]);

      // TODO: change to cameras
      keyListener.simple_combo('1', function(){
         toggleTargetTo('target1');
      });
      keyListener.simple_combo('2', function(){
         toggleTargetTo('target2');
      });
      keyListener.simple_combo('3', function(){
         toggleTargetTo('target3');
      });
      keyListener.simple_combo('4', function(){
         toggleTargetTo('target4');
      });

      // function KeyListenerSimpleCombo(base, buildArray){
      //    for(i = 0; i < buildArray.length; i++){
      //       var keyTrigger = String(buildArray[i]);
      //       var target = String(base + keyTrigger);
      //       keyListener.simple_combo(keyTrigger, function(){
      //          toggleTargetTo(target);
      //       });
      //    }
      // }

      /*
      Builds the planets{} by looping through ids
      */
      function buildPlanets(planets){

         // Loop it to build {}
         for(i = 0; i < planets.els.length; i++){
            var planet = planets.els[i];
            var planetName = planet.getAttribute('id');
            var planetEl = scene.querySelector('#' + planetName)

            // Create the planet object entry
            planets[planetName] = {
               el:               planetEl,
               classes:          planetEl.getAttribute('class'),

               planetaryRadius:     planetEl.getAttribute('planetary-radius'),
               planetaryColor:      planetEl.getAttribute('planetary-color'),
               // planetaryAxis:       planetEl.getAttribute('planetary-axis'),
               planetaryPosition:   planetEl.getAttribute('planetary-position'), // rotational angle to euclidian
               orbitalRadius:       planetEl.getAttribute('orbital-radius'),
               orbitalSpeed:        planetEl.getAttribute('orbital-speed')
            };

            // Create the planet in the DOM
            var planetDOM = planets[planetName].el.querySelector('a-sphere');
            planetDOM.setAttribute('geometry', {
               primitive:  'sphere',
               radius:     planets[planetName].planetaryRadius
            });
            planetDOM.setAttribute('material', {
               color:      planets[planetName].planetaryColor
            });
            planetDOM.setAttribute('position', {
               x: Number(planets[planetName].orbitalRadius) * Math.sin(Number(planets[planetName].planetaryPosition) / (360 * Math.PI * 2)),
               y: 0,
               z: Number(planets[planetName].orbitalRadius) * Math.cos(Number(planets[planetName].planetaryPosition) / (360 * Math.PI * 2))
            });
            // console.log(planetDOM.getAttribute('position'));
            // Create the animation in the DOM
            var animationDOM = planets[planetName].el.querySelector('a-animation');
            animationDOM.setAttribute('attribute', 'rotation');
            animationDOM.setAttribute('dur', 360 / planets[planetName].orbitalSpeed * 1000);
            animationDOM.setAttribute('fill', 'forwards');
            animationDOM.setAttribute('to', '0 360 0');
            animationDOM.setAttribute('repeat', 'indefinite');
            animationDOM.setAttribute('easing', 'linear');
         }



         // Return the object
         return planets;
      }

   </script>
   </body>
</html>
