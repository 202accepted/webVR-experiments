<!doctype html>
<html>
<head>
   <title>10 - SpaceVR Simulator</title>
   <meta name="viewport" content="width=device-width,initial-scale=1,shrink-to-fit=no,user-scalable=no,maximum-scale=1">
   <script src="bower_components/aframe/dist/aframe.min.js"></script>
   <script src="bower_components/Keypress/keypress.js"></script>
   <script src="js/global-functions.js"></script>
   <style>
   *{
      cursor: none;
   }
   </style>

</head>
<body>

   <a-scene id="main-scene" fog="type: exponential; color: #000; density: .0003">

      <!-- Global Settings -->
      <a-sky color="#111"></a-sky>

      <!-- Global Cameras -->
      <a-camera id="camera" position="0 0 0" active="true"></a-camera>


      <!-- World Elements -->
      <a-entity id="universe">
<!--
         <a-entity   id="sun"
                     class="planet"
                     planetary-radius="695700"
                     planetary-color="yellow"
                     planetary-axis="0 0 0"
                     planetary-position="0"
                     orbital-radius="149598023"
                     orbital-speed="29.78" domFlag>
            <a-sphere mixin="planet"></a-sphere>
            <a-animation></a-animation>
         </a-entity> -->

         <!--

         km    planetary-radius
               planetary-color
               planetary-axis
         deg   planetary-position
         km    orbital-radius
         km/s  orbital-speed

         -->

         </a-entity>

      </a-entity>

   </a-scene>

   <script>

      var settings = {
         enterVR:                false,
         reload:                 false,                 // When developing, it's nice if your phone reloads automatically
         reloadTime:             20,                  // In seconds
         scalarOrbitalRadius:    1 / 1000000,
         scalarPlanetaryRadius:  1 / 500,
         scalarSunRadius:        1 / 20000
      }



      /*
         Setup global variables
      */
      var scene = document.querySelector('#main-scene');
      var universe = document.querySelector('#universe');

      var planets = {
         els: scene.querySelectorAll('.planet'),
         // The rest of the object gets built with buildPlanets()
      }

      var cameras = {
         els: scene.querySelectorAll('a-camera'),
         active: settings.camera
         // The rest of the object gets built with buildCameras()
      }

      /*
         Add event listener to run after scene is loaded
      */
      scene.addEventListener('loaded', function(){

         buildPlanets(planets);
         scaleSun();
         buildCameras(cameras);

         toggleCameraTo(cameras.active);

         devTools();

      });

      /*
         Keylistener functions
      */
      // Setup
      var keyListener = new window.keypress.Listener();

      // check targets object
      keyListener.simple_combo('c', function(){
         console.log(targets);
      });

      /*
      Builds the planets{} by looping through ids
      */
      function buildPlanets(planets){

         // Loop it to build {}
         for(i = 0; i < planets.els.length; i++){
            var planet = planets.els[i];
            var planetName = planet.getAttribute('id');
            var planetEl = scene.querySelector('#' + planetName)

            // Create the planet object entry and scale appropriately
            planets[planetName] = {
               el:               planetEl,
               classes:          planetEl.getAttribute('class'),

               planetaryRadius:     planetEl.getAttribute('planetary-radius') * settings.scalarPlanetaryRadius,
               planetaryColor:      planetEl.getAttribute('planetary-color'),
               // planetaryAxis:       planetEl.getAttribute('planetary-axis'),
               planetaryPosition:   planetEl.getAttribute('planetary-position'), // rotational angle to euclidian
               orbitalRadius:       planetEl.getAttribute('orbital-radius') * settings.scalarOrbitalRadius,
               orbitalSpeed:        planetEl.getAttribute('orbital-speed')
            };

            // Create the planet in the DOM
            var planetDOM = planets[planetName].el.querySelector('a-sphere');
            planetDOM.setAttribute('geometry', {
               primitive:  'sphere',
               radius:     planets[planetName].planetaryRadius
            });
            planetDOM.setAttribute('material', {
               color:      planets[planetName].planetaryColor
            });
            planetDOM.setAttribute('position', {
               x: Number(planets[planetName].orbitalRadius) * Math.sin(Number(planets[planetName].planetaryPosition) * Math.PI),
               y: 0,
               z: Number(planets[planetName].orbitalRadius) * Math.cos(Number(planets[planetName].planetaryPosition) * Math.PI)
            });
            // console.log(planetDOM.getAttribute('position'));
            // Create the animation in the DOM
            var animationDOM = planets[planetName].el.querySelector('a-animation');
            animationDOM.setAttribute('attribute', 'rotation');
            animationDOM.setAttribute('dur', 360 / planets[planetName].orbitalSpeed * 1000);
            animationDOM.setAttribute('fill', 'forwards');
            animationDOM.setAttribute('to', '0 360 0');
            animationDOM.setAttribute('repeat', 'indefinite');
            animationDOM.setAttribute('easing', 'linear');
         }

         // Return the object
         return planets;
      }

      function scaleSun(){
         var sunEl = scene.querySelector('#sun')
         var sunRadius = sunEl.getAttribute('radius');

         sunEl.setAttribute('radius', sunRadius * settings.scalarSunRadius);

      }

   </script>
   </body>
</html>
